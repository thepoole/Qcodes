<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QCoDeS Example with AMI430 &mdash; QCoDeS 0.30.0.dev0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="QCoDeS Example with Agilent 34400A" href="Qcodes%20example%20with%20Agilent%2034400A.html" />
    <link rel="prev" title="QCoDeS example with Textronix DPO 7200xx scopes" href="QCodes%20example%20with%20Tektronix%20DPO%2072004C.html" />
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> QCoDeS
          </a>
              <div class="version">
                0.30.0.dev0+433.gef36c42fa
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html">Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataset/index.html">DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">QCoDes API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/generated/qcodes.instrument_drivers.html">qcodes.instrument_drivers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes/index.html">Changelogs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples of using QCoDeS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#basic-examples">Basic examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#dataset">DataSet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#plotting">Plotting</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#drivers">Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20Example%20with%20Keysight%20E4980A%20LCR%20meter.html">QCoDeS Example with Keysight E4980A LCR meter</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20Example%20with%20Yokogawa%20GS200%20and%20Keithley%207510.html">QCoDeS Example with Yokogawa GS200 and Keithley 7510 Multimeter</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20Aim%20TTi%20PL601-P.html">QCoDeS example with Aim TTi PL601-P</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20DelegateInstrument.html">Qcodes example with DelegateInstrument driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20DelegateInstrument.html#Devices-with-channels">Devices with channels</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20Galil%20DMC4133%20Controller.html">QCoDeS example with Galil DMC4133 Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20Galil%20DMC4133%20Controller.html#Imports">Imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20Galil%20DMC4133%20Controller.html#DMC4133-Controller">DMC4133 Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20Galil%20DMC4133%20Controller.html#Arm-class">Arm class</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20Galil%20DMC4133%20Controller.html#Calibration">Calibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20Galil%20DMC4133%20Controller.html#Integration-with-measurement-process">Integration with measurement process</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20InstrumentGroup%20and%20DelegateInstrument.html">Qcodes example with InstrumentGroup driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCoDeS%20example%20with%20Keithley%203706A%20System%20Switch.html">QCoDeS example with Keithley 3706A System Switch</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCodes%20example%20with%20Keithley%20S46.html">QCoDeS Example with Tektronix Keithley S46</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCodes%20example%20with%20QDevil_QDAC.html">QCoDeS Example with QDevil_QDAC</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCodes%20example%20with%20Rigol%20DG1062.html">QCoDeS Example with the Rigol DG 1062 Instrument</a></li>
<li class="toctree-l3"><a class="reference internal" href="QCodes%20example%20with%20Tektronix%20DPO%2072004C.html">QCoDeS example with Textronix DPO 7200xx scopes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">QCoDeS Example with AMI430</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Summary-of-automated-tests-that-the-driver-goes-through">Summary of automated tests that the driver goes through</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Connecting-to-the-individual-axis-instruments">Connecting to the individual axis instruments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Working-with-a-single-axis">Working with a single axis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Working-with-the-3D-driver,-controlling-all-3-axes">Working with the 3D driver, controlling all 3 axes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Dond-while-ramping">Dond while ramping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Agilent%2034400A.html">QCoDeS Example with Agilent 34400A</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Alazar%20ATS9360.html">QCoDeS Example with Alazar ATS 9360</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Basel%20SP983c%20Preamp.html">Qcodes example with Basel SP983c Preamp and its Remote SP983a</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20DynaCool%20PPMS.html">QCoDeS Example with DynaCool PPMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20HP8753D.html">QCoDeS Example with HP8753D</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Ithaco.html">QCoDeS Example with Itacho</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keithley%202600.html">QCoDeS Example with with Keithley 2600</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keithley%207510.html">QCoDeS Example with Tektronix Keithley 7510 Multimeter</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keysight%2033500B.html">QCoDeS Example with Keysight 33500B</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keysight%20344xxA.html">QCoDeS Example with Keysight 344xxA</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keysight%2034980A%20Switch%20Mainframe%20and%20Modules.html">QCoDeS Example with Keysight 34980A Multifunction Switch / Measure Mainframe and Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keysight%20B1500%20Parameter%20Analyzer.html">Qcodes example with Keysight B1500 Semiconductor Parameter Analyzer</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keysight%20B2200%20Series%20Femto%20Leakage%20Switch%20Matrix.html">QCoDeS Example with Keysight B2200 Series Femto Leakage Switch Matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keysight%20Infiniium%20Oscilloscope.html">QCoDeS Example with Keysight Infiniium Oscilloscopes</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keysight%20N9030B.html">Qcodes example with Keysight N9030B</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Keysight%20Network%20Analyzer.html">QCoDeS Example with Keysight Network Analyzers</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Lakeshore%20325.html">QCoDeS Example with Lakeshore 325</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Lakeshore%20336%20or%20372%20-%20Bluefors%20T%20control.html">QCoDeS Example with the Lakeshore Model 372 to Control the Temperature of the Bluefors Fridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Minicircuits%20Switch%20boxes%20%28USB-XSPDT%29.html">QCoDeS Example with Minicircuits Switch Boxes Controlled via USB</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Newport%20AG-UC8.html">QCoDeS Example with Newport AG-UC8 Piezo Motion Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Oxford%20Mercury%20iPS.html">QCoDeS Example with Mercury iPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Oxford%20Triton.html">QCoDeS Example with Oxford Triton</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20QDac.html">QCoDeS Example with QDac</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20QDac_channels.html">QCoDeS Example with QDac_channels</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Rigol%20DP832.html">QCoDeS Example with Rigol DP832 Power Supply</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Rigol%20DS1074Z.html">QCoDeS Example with the Rigol DS 1074 Z oscilloscope</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Rohde%20Schwarz%20HMC8043.html">QCoDeS Example with R&amp;S HMC 8043 Power Supply</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Rohde%20Schwarz%20RTO%201000%20series%20Oscilloscope.html">QCoDeS Example with Rohde Schwarz RTO 1000 Series Oscilloscope</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Rohde%20Schwarz%20ZNB.html">QCoDeS Example with Rohde Schwarz ZNB20/8</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Stahl.html">QCoDeS Example with the Stahl Bias Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Stanford%20SR830.html">QCoDeS Example with Stanford SR830</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Stanford%20SR86x%20with%20buffered%20readout.html">QCoDeS Example with Standford Research SR86x Lock-in Amplifier with Buffered Readout</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Tektronix%20AWG5014C.html">QCoDeS Example with Tektronix AWG5014</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Tektronix%20AWG70002A.html">QCoDeS Example with Tektronix AWG70002A</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Tektronix%20TPS2012.html">QCoDeS Example with Tektronix TPS2012</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20Yokogawa%20GS2xx.html">QCoDeS Example with Yokogawa GS200/GS210</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%20example%20with%20keithley%202450.html">QCoDeS Example with Tektronix Keithley 2450 Source Meter</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes%2Bbroadbean%20example%20with%20Tektronix%20AWG5208.html">QCoDeS+Broadbean Example with Tektronix AWG5208</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes-example-with-Signal-Hound-USB-SA124B.html">QCoDeS Example with Signal Hound USB-SA124B</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes-example-with-Signal-Hound-USB-SA124B-ParameterWithSetpoints.html">QCoDeS Example with Signal Hound USB-SA124B ParameterWithSetpoints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#writing-drivers">Writing Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#logging">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#legacy-examples">Legacy examples</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QCoDeS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Examples of using QCoDeS</a> &raquo;</li>
      <li>QCoDeS Example with AMI430</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/driver_examples/Qcodes example with AMI430.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
  <p>This page was generated from
    <a class="reference external"
    href="https://github.com/qcodes/qcodes/blob/master/docs/examples/driver_examples/Qcodes example with AMI430.ipynb">docs/examples/driver_examples/Qcodes example with AMI430.ipynb</a>.
    Interactive online version:
    <a href="https://mybinder.org/v2/gh/qcodes/qcodes/master?filepath=docs/examples/driver_examples/Qcodes example with AMI430.ipynb"><img
alt="Binder badge"
    src="https://mybinder.org/badge_logo.svg"
    style="vertical-align:text-bottom"></a>.
  </p>
  <script>
    if (document.location.host) {
      var p = document.currentScript.previousSibling.previousSibling;
      var a = document.createElement('a');
      a.innerHTML = 'View in <em>nbviewer</em>';
      a.href = `https://nbviewer.jupyter.org/url${
        (window.location.protocol == 'https:' ? 's/' : '/') +
        window.location.host +
        window.location.pathname.slice(0, -4) }ipynb`;
      a.classList.add('reference');
      a.classList.add('external');
      p.appendChild(a);
      p.appendChild(document.createTextNode('.'));
    }
  </script>
</div><section id="QCoDeS-Example-with-AMI430">
<h1>QCoDeS Example with AMI430<a class="headerlink" href="#QCoDeS-Example-with-AMI430" title="Permalink to this headline"></a></h1>
<section id="Summary-of-automated-tests-that-the-driver-goes-through">
<h2>Summary of automated tests that the driver goes through<a class="headerlink" href="#Summary-of-automated-tests-that-the-driver-goes-through" title="Permalink to this headline"></a></h2>
<p>We have performed a lot of stand alone tests (tests with mocked hardware) in qcodes/tests/test_ami430.py. In particular, we have tested: - If the driver remembers the internal setpoints if these are given in cartesian, spherical and cylindrical coordinates - Check that we send to correct setpoint instructions to the individual instruments if inputs are cartesian, spherical or cylindrical coordinates - Test that we can call the measured parameters (e.g. cartesian_measured) without exceptions
occuring. - Check that instruments which need to ramp down are given adjustment instructions first - Check that field limit exceptions are raised properly - Check that the driver remembers theta and phi coordinates even if the vector norm is zero. - Test that a warning is issued when the maximum ramp rate is increased - Test that an exception is raised when we try to set a ramp rate which is higher then the maximum allowed value.</p>
<p>Furthermore, in qcodes/tests/test_field_vector.py we have tested if the cartesian to spherical/cylindircal coordinate transformations and visa-versa has been correctly implemented by asserting symmetry rules.</p>
</section>
<section id="Connecting-to-the-individual-axis-instruments">
<h2>Connecting to the individual axis instruments<a class="headerlink" href="#Connecting-to-the-individual-axis-instruments" title="Permalink to this headline"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">qcodes.instrument_drivers.american_magnetics.AMI430</span> <span class="kn">import</span> <span class="n">AMI430</span><span class="p">,</span> <span class="n">AMI430_3D</span>
<span class="kn">from</span> <span class="nn">qcodes.math_utils.field_vector</span> <span class="kn">import</span> <span class="n">FieldVector</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check if we can establish communication with the power sources</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">AMI430</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s2">&quot;169.254.146.116&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7180</span><span class="p">)</span>
<span class="n">iy</span> <span class="o">=</span> <span class="n">AMI430</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s2">&quot;169.254.136.91&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7180</span><span class="p">)</span>
<span class="n">iz</span> <span class="o">=</span> <span class="n">AMI430</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s2">&quot;169.254.21.127&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7180</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Connected to: AMERICAN MAGNETICS INC. 430 (serial:2.01, firmware:None) in 0.60s
Connected to: AMERICAN MAGNETICS INC. 430 (serial:2.01, firmware:None) in 0.62s
Connected to: AMERICAN MAGNETICS INC. 430 (serial:2.01, firmware:None) in 0.57s
</pre></div></div>
</div>
</section>
<section id="Working-with-a-single-axis">
<h2>Working with a single axis<a class="headerlink" href="#Working-with-a-single-axis" title="Permalink to this headline"></a></h2>
<p>On individual instruments (individual axes), we:</p>
<ul class="simple">
<li><p>Test that we can correctly set current values of individual sources</p></li>
<li><p>Test that we can correctly measure current values of individual sources</p></li>
<li><p>Test that we can put the sources in paused mode</p></li>
<li><p>Test that the ramp rates are properly set</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># lets test an individual instrument first. We select the z axis.</span>
<span class="n">instrument</span> <span class="o">=</span> <span class="n">iz</span>

<span class="c1"># Since the set method of the driver only excepts fields in Tesla and we want to check if the correct</span>
<span class="c1"># currents are applied, we need to convert target currents to target fields. For this reason we need</span>
<span class="c1"># the coil constant.</span>
<span class="n">coil_const</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">_coil_constant</span>
<span class="n">current_rating</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">_current_rating</span>
<span class="n">current_ramp_limit</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">_current_ramp_limit</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coil constant = </span><span class="si">{}</span><span class="s2"> T/A&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coil_const</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current rating = </span><span class="si">{}</span><span class="s2"> A&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_rating</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current ramp rate limit = </span><span class="si">{}</span><span class="s2"> A/s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_ramp_limit</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coil constant = 0.076 T/A
current rating = 79.1 A
current ramp rate limit = 0.06 A/s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Let see if we can set and get the field in Tesla</span>
<span class="n">target_current</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># [A]  The current we want to set</span>
<span class="n">target_field</span> <span class="o">=</span> <span class="n">coil_const</span> <span class="o">*</span> <span class="n">target_current</span>  <span class="c1"># [T]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target field is </span><span class="si">{}</span><span class="s2"> T&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_field</span><span class="p">))</span>
<span class="n">instrument</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">target_field</span><span class="p">)</span>

<span class="n">field</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">field</span><span class="p">()</span>  <span class="c1"># This gives us the measured field</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Measured field is </span><span class="si">{}</span><span class="s2"> T&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
<span class="c1"># The current should be</span>
<span class="n">current</span> <span class="o">=</span> <span class="n">field</span> <span class="o">/</span> <span class="n">coil_const</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Measured current is = </span><span class="si">{}</span><span class="s2"> A&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
<span class="c1"># We have verified with manual inspection that the current has indeed ben reached</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Target field is 0.076 T
Measured field is 0.07604 T
Measured current is = 1.0005263157894737 A
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Verify that the ramp rate is indeed how it is specified</span>
<span class="n">ramp_rate</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">ramp_rate</span><span class="p">()</span>  <span class="c1"># get the ramp rate</span>
<span class="n">instrument</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># make sure we are back at zero amps</span>

<span class="n">target_fields</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>  <span class="c1"># [T]</span>
<span class="n">t_setting</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">t_actual</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">target_field</span> <span class="ow">in</span> <span class="n">target_fields</span><span class="p">:</span>

    <span class="n">current_field</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">field</span><span class="p">()</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target_field</span> <span class="o">-</span> <span class="n">current_field</span><span class="p">)</span> <span class="o">/</span> <span class="n">ramp_rate</span>
    <span class="n">t_setting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

    <span class="n">tb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">instrument</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">target_field</span><span class="p">)</span>
    <span class="n">te</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">ta</span> <span class="o">=</span> <span class="n">te</span> <span class="o">-</span> <span class="n">tb</span>
    <span class="n">t_actual</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ta</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_setting</span><span class="p">,</span> <span class="n">t_actual</span><span class="p">,</span> <span class="s2">&quot;.-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;ramp time calculated from settings [s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;measured ramp time [s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">t_setting</span><span class="p">,</span> <span class="n">t_actual</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;slope = </span><span class="si">{}</span><span class="s2">. A value close to one means the correct ramp times are used&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;offset = </span><span class="si">{}</span><span class="s2">. An offset indicates that there is a fixed delay is added to a ramp request&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_driver_examples_Qcodes_example_with_AMI430_8_0.png" src="../../_images/examples_driver_examples_Qcodes_example_with_AMI430_8_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
slope = 0.9993355432517128. A value close to one means the correct ramp times are used
offset = 7.364001916301564. An offset indicates that there is a fixed delay is added to a ramp request
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Lets move back to zero Amp</span>
<span class="n">instrument</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Note-on-maximum-current-ramp-rate">
<h3>Note on maximum current ramp rate<a class="headerlink" href="#Note-on-maximum-current-ramp-rate" title="Permalink to this headline"></a></h3>
<p>The maximum current ramp rate can be increased to a desired value via setting the <code class="docutils literal notranslate"><span class="pre">current_ramp_limit</span></code> parameter. However, this should be done conservatively to avoid quenching the magnet. We strongly recommend to consult to the manual of your particular magnet before making any changes.</p>
</section>
</section>
<section id="Working-with-the-3D-driver,-controlling-all-3-axes">
<h2>Working with the 3D driver, controlling all 3 axes<a class="headerlink" href="#Working-with-the-3D-driver,-controlling-all-3-axes" title="Permalink to this headline"></a></h2>
<p>With the 3D driver, we:</p>
<ul class="simple">
<li><p>Test that the correct set points are reached if we give inputs in cartesian, spherical or cylindrical coordinates</p></li>
<li><p>Test that we can set theta and phi to non-zero values which are remembered if r is ramped from zero to r &gt; 0.</p></li>
<li><p>Test that instruments are ramped up and down in the correct order, with ramp downs occuring before ramp ups.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Lets test the 3D driver now.</span>
<span class="n">field_limit</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># If any of the field limit functions are satisfied we are in the safe zone.</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># We can have higher field along the z-axis if x and y are zero.</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2</span>
<span class="p">]</span>

<span class="n">i3d</span> <span class="o">=</span> <span class="n">AMI430_3D</span><span class="p">(</span>
    <span class="s2">&quot;AMI430-3D&quot;</span><span class="p">,</span>
    <span class="n">ix</span><span class="p">,</span>
    <span class="n">iy</span><span class="p">,</span>
    <span class="n">iz</span><span class="p">,</span>
    <span class="n">field_limit</span><span class="o">=</span><span class="n">field_limit</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">current_to_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;We cannot set currents directly, so we need to calculate what fields need to be generated for</span>
<span class="sd">    the desired currents&quot;&quot;&quot;</span>
    <span class="n">instrument</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">ix</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">iy</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">iz</span><span class="p">}[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">coil_constant</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">_coil_constant</span> <span class="c1">#  [T/A]</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">current</span> <span class="o">*</span> <span class="n">coil_constant</span>
    <span class="k">return</span> <span class="n">field</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Lets see if we can set a certain current using cartesian coordinates</span>
<span class="n">current_target</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
<span class="c1"># calculate the fields needed</span>
<span class="n">field_target</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_to_field</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">current_target</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;field target = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_target</span><span class="p">))</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">field_target</span><span class="p">)</span>
<span class="n">field_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">cartesian_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;field measured = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_measured</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
field target = [0.0386, 0.0121, 0.11399999999999999]
field measured = [0.03816, 0.01211, 0.11384]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Lets move back to 0,0,0</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">cartesian</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># Lets see if we can set a certain current using spherical coordinates</span>
<span class="n">current_target</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
<span class="c1"># calculate the fields needed</span>
<span class="n">field_target_cartesian</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_to_field</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">current_target</span><span class="p">)]</span>
<span class="c1"># calculate the field target in spherical coordinates</span>
<span class="n">field_target_spherical</span> <span class="o">=</span> <span class="n">FieldVector</span><span class="p">(</span><span class="o">*</span><span class="n">field_target_cartesian</span><span class="p">)</span><span class="o">.</span><span class="n">get_components</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;field target = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_target_spherical</span><span class="p">))</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">spherical</span><span class="p">(</span><span class="n">field_target_spherical</span><span class="p">)</span>
<span class="n">field_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">spherical_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;field measured = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_measured</span><span class="p">))</span>
<span class="c1"># Like before, we see that the current target of 1.0, 0.5, 1.5 A for x, y and z have indeed been reached</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
field target = [0.1209643335863923, 19.536859161547078, 17.404721375291402]
field measured = [0.12077462481829535, 19.424782613847988, 17.532727661391853]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Lets move back to 0,0,0</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">cartesian</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># Lets see if we can set a certain current using cylindrical coordinates</span>
<span class="n">current_target</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
<span class="c1"># calculate the fields needed</span>
<span class="n">field_target_cartesian</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_to_field</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">current_target</span><span class="p">)]</span>
<span class="c1"># calculate the field target in cylindrical coordinates</span>
<span class="n">field_target_cylindrical</span> <span class="o">=</span> <span class="n">FieldVector</span><span class="p">(</span><span class="o">*</span><span class="n">field_target_cartesian</span><span class="p">)</span><span class="o">.</span><span class="n">get_components</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;field target = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_target_cylindrical</span><span class="p">))</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">cylindrical</span><span class="p">(</span><span class="n">field_target_cylindrical</span><span class="p">)</span>
<span class="n">field_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">cylindrical_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;field measured = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_measured</span><span class="p">))</span>
<span class="c1"># Like before, we see that the current target of 1.0, 0.5, 1.5 A for x, y and z have indeed been reached</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
field target = [0.040452070404368677, 17.404721375291402, 0.11399999999999999]
field measured = [0.040235668255914431, 17.51627743673798, 0.11365]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Test that ramping up and down occurs in the right order,</span>
<span class="c1"># that is, first, ramp axes that have ramp down,</span>
<span class="c1"># and only then ramp axes that have to ramp up.</span>
<span class="n">current_target</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>  <span class="c1"># We ramp down the z, ramp up y and keep x the same</span>
<span class="c1"># We should see that z is adjusted first, then y.</span>
<span class="c1"># calculate the fields needed</span>
<span class="n">field_target</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_to_field</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">current_target</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;field target = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_target</span><span class="p">))</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">field_target</span><span class="p">)</span>
<span class="c1"># Manual inspection has shown that z is indeed ramped down before y is ramped up</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
field target = [0.0386, 0.01815, 0.076]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># check that an exception is raised when we try to set a field which is out side of the safety limits</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">i3d</span><span class="o">.</span><span class="n">cartesian</span><span class="p">([</span><span class="mf">2.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;something went wrong... we should not be able to do this :-(&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error successfully raised. The driver does not let you do stupid stuff&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
error successfully raised. The driver does not let you do stupid stuff
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check that the driver remembers theta/phi values if the set point norm is zero</span>

<span class="c1"># lets go back to zero field</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">cartesian</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="c1"># Lets set theta and phi to a non zero value but keep the field magnitude at zero</span>
<span class="n">field_target_spherical</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.0</span><span class="p">]</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">spherical</span><span class="p">(</span><span class="n">field_target_spherical</span><span class="p">)</span>
<span class="n">field_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">cartesian_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1: Measured field = </span><span class="si">{}</span><span class="s2"> T&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_measured</span><span class="p">))</span>

<span class="c1"># Note that theta_measured and phi_measured will give random values based on noisy current reading</span>
<span class="c1"># close to zero (this cannot be avoided)</span>
<span class="n">theta_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">theta_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1: Theta measured = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta_measured</span><span class="p">))</span>
<span class="n">phi_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">phi_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1: Phi measured = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phi_measured</span><span class="p">))</span>

<span class="c1"># now lets set the r value</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">field_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">cartesian_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2: Measured field = </span><span class="si">{}</span><span class="s2"> T&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_measured</span><span class="p">))</span>
<span class="c1"># Now the measured angles should be as we intended</span>
<span class="n">theta_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">theta_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2: Theta measured = </span><span class="si">{}</span><span class="s2">. We see that the input theta of </span><span class="si">{}</span><span class="s2"> has been &quot;</span>
      <span class="s2">&quot;remembered&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta_measured</span><span class="p">,</span> <span class="n">field_target_spherical</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">phi_measured</span> <span class="o">=</span> <span class="n">i3d</span><span class="o">.</span><span class="n">phi_measured</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2: Phi measured = </span><span class="si">{}</span><span class="s2">. We see that the input phi of </span><span class="si">{}</span><span class="s2"> has been &quot;</span>
      <span class="s2">&quot;remembered&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phi_measured</span><span class="p">,</span> <span class="n">field_target_spherical</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1: Measured field = [-0.00013, -1e-05, 3e-05] T
1: Theta measured = 98.72079692816342
1: Phi measured = 180.0
2: Measured field = [0.10484, -0.08797, 0.37558] T
2: Theta measured = 20.032264760097508. We see that the input theta of 20.0 has been remembered
2: Phi measured = -40.007172479040996. We see that the input phi of -40.0 has been remembered
</pre></div></div>
</div>
<section id="Simultaneous-ramping-mode">
<h3>Simultaneous ramping mode<a class="headerlink" href="#Simultaneous-ramping-mode" title="Permalink to this headline"></a></h3>
<p>The 3D driver has a <code class="docutils literal notranslate"><span class="pre">ramp_mode</span></code> parameter whose default value is <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code>. In this mode, the ramping of all the 3 axes is sequential e.g. first X axis is ramped until its setpoint, then Y axis, then Z axis. In order to ramp all the three axis together, simultaneously, there exists another ramp mode called <code class="docutils literal notranslate"><span class="pre">&quot;simultaneous&quot;</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">ramp_mode</span><span class="p">(</span><span class="s2">&quot;simultaneous&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Thanks to all there axes instruments being swept together, the magnetic field changes along the vector from the current/initial field value towards the setpoint value. Use the simultaneous mode either by setting <code class="docutils literal notranslate"><span class="pre">vector_ramp_rate</span></code> parameter, or by calling <code class="docutils literal notranslate"><span class="pre">ramp_simultaneously</span></code> convenience method.</p>
<p>To return to the default ramp mode, set the ramp mode parameter to <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">ramp_mode</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">vector_ramp_rate</span></code> parameter corresponds to the desired ramp rate along the vector from the current magnetic field value to the setpoint value. Before the ramp is started, the value of the <code class="docutils literal notranslate"><span class="pre">vector_ramp_rate</span></code> is used to calculate the ramp rates for the individual axes instruments. To initiate the ramp, use any of the already familiar parameters that set the field setpoint value, e.g. <code class="docutils literal notranslate"><span class="pre">i3d.cartesian([0.1,</span> <span class="pre">0.2,</span> <span class="pre">0.3])</span></code>. Use the <code class="docutils literal notranslate"><span class="pre">vector_ramp_rate</span></code> approach if you would like to sweep all
axes simultaneously <em>at a given ramp rate along the vector towards the setpoint value</em>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">ramp_mode</span><span class="p">(</span><span class="s2">&quot;simultaneous&quot;</span><span class="p">)</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">vector_ramp_rate</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># requires all axes to have same ramp rate units!!!</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># or any other parameter call that initiates a ramp</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">vector_ramp_rate</span></code> parameter assumes that the given value is in the same ramp units as the units of all the three individual axis instruments. If not all axis instruments have the same ramp rate units, an exception will be raised.</p>
<p><code class="docutils literal notranslate"><span class="pre">ramp_simultaneously</span></code> method takes the sweep duration as it’s argument, that is used to calculate the corresponding <code class="docutils literal notranslate"><span class="pre">vector_ramp_rate</span></code>, which will in turn be used to set ramp rates of the individual axes, and initiate the ramp. Use the <code class="docutils literal notranslate"><span class="pre">ramp_simultaneously</span></code> approach if you would like to sweep all axes simultaneously <em>in a given time</em> along the vector towards the setpoint value:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">ramp_simultaneously</span><span class="p">(</span><span class="n">setpoint</span><span class="o">=</span><span class="n">FieldVector</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="n">duration</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># See the docstring of this method for details</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ramp_simultaneously</span></code> method assumes that the given setpoint value as well as the given duration are in the same units as the units of all the three individual axis instruments. If not all axis instruments have the same units for ramp rate and field, an exception will be raised.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">block_during_ramp</span></code> parameter is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the call that initiated the ramp (either <code class="docutils literal notranslate"><span class="pre">ramp_simultaneously</span></code> or call to a field setpoint parameter) will return right after the ramp is initiated. Otherwise, the calls will block until the ramp is complete (that is, until all 3 axes stopped ramping).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">block_during_ramp</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The driver comes with convenient methods that can be used in the measurement code to implement checks for completion of the ramping process (e.g. for waiting until the ramping is complete): <code class="docutils literal notranslate"><span class="pre">i3d.wait_while_all_axes_ramping</span></code> that blocks until the ramping is complete (check that ramping state every <code class="docutils literal notranslate"><span class="pre">i3d.ramping_state_check_interval</span></code> seconds), and <code class="docutils literal notranslate"><span class="pre">i3d.any_axis_is_ramping</span></code> that returns <code class="docutils literal notranslate"><span class="pre">True</span></code>/<code class="docutils literal notranslate"><span class="pre">False</span></code> based on whether the ramping is still in process or completed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">any_axis_is_ramping</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">wait_while_all_axes_ramping</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">ramping_state_check_interval</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">i3d.pause</span></code> method to request all three axes instruments to pause ramping:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i3d</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>For user convenience, the calculation methods between vactor ramp rate, sweep duration, and individual ramp rates for axes are exposed: see <code class="docutils literal notranslate"><span class="pre">i3d.calculate_axes_ramp_rates_from_vector_ramp_rate</span></code>, <code class="docutils literal notranslate"><span class="pre">i3d.calculate_vector_ramp_rate_from_duration</span></code>, <code class="docutils literal notranslate"><span class="pre">i3d.calculate_axes_ramp_rates_for</span></code> methods.</p>
<p>Note that the results of testing on the real instruments show that: - if the requested field change is 0 for one/two/all-three axes, ramping still “simply works”, e.g. the instrument attempts to ramp, finds that it’s already in the right place, and stops ramping - if the requested field change for a given axis results in a ramp rate that is less than minimal ramp rate, the instrument still ramps to the corresponding setpoint value at some small ramp rate</p>
</section>
</section>
<section id="Dond-while-ramping">
<h2>Dond while ramping<a class="headerlink" href="#Dond-while-ramping" title="Permalink to this headline"></a></h2>
<p>Lets now look at how the simultaneous ramp mode can be integrated with a typical measurement. The idea is to start the ramp and then do a dond scan with a fixed delay until the ramp is completed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">qcodes.dataset</span> <span class="kn">import</span> <span class="n">load_or_create_experiment</span>
<span class="kn">from</span> <span class="nn">qcodes.tests.instrument_mocks</span> <span class="kn">import</span> <span class="n">DummyInstrument</span><span class="p">,</span> <span class="n">DummyInstrumentWithMeasurement</span>
<span class="kn">from</span> <span class="nn">qcodes.instrument.specialized_parameters</span> <span class="kn">import</span> <span class="n">ElapsedTimeParameter</span>
<span class="kn">from</span> <span class="nn">qcodes.utils.dataset.doNd</span> <span class="kn">import</span> <span class="n">dond</span><span class="p">,</span> <span class="n">LinSweep</span><span class="p">,</span> <span class="n">do2d</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># preparatory mocking of physical setup</span>
<span class="n">dac</span> <span class="o">=</span> <span class="n">DummyInstrument</span><span class="p">(</span><span class="s1">&#39;dac&#39;</span><span class="p">,</span> <span class="n">gates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ch1&#39;</span><span class="p">,</span> <span class="s1">&#39;ch2&#39;</span><span class="p">])</span>
<span class="n">dmm</span> <span class="o">=</span> <span class="n">DummyInstrumentWithMeasurement</span><span class="p">(</span><span class="s1">&#39;dmm&#39;</span><span class="p">,</span> <span class="n">setter_instr</span><span class="o">=</span><span class="n">dac</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tutorial_exp</span> <span class="o">=</span> <span class="n">load_or_create_experiment</span><span class="p">(</span><span class="s1">&#39;doNd_while_ramping&#39;</span><span class="p">,</span> <span class="n">sample_name</span><span class="o">=</span><span class="s1">&#39;no sample&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sweep_1</span> <span class="o">=</span> <span class="n">LinSweep</span><span class="p">(</span><span class="n">dac</span><span class="o">.</span><span class="n">ch1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">sweep_2</span> <span class="o">=</span> <span class="n">LinSweep</span><span class="p">(</span><span class="n">dac</span><span class="o">.</span><span class="n">ch2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">time_p</span> <span class="o">=</span> <span class="n">ElapsedTimeParameter</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">zero_field</span> <span class="o">=</span> <span class="n">FieldVector</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">zero_field</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FieldVector(x=0.0, y=0.0, z=0.0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">setpoint</span> <span class="o">=</span> <span class="n">FieldVector</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
<span class="n">setpoint</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FieldVector(x=0.02, y=0.02, z=0.02)
</pre></div></div>
</div>
<p>First we start with a example that is independent of the magnets but shows how we can measure a 2D scan as a function of time. Note that we keep the timing logic minimal, so the points may not be equidistant in time. This can be extended if needed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">timed_datasets</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">time_p</span><span class="o">.</span><span class="n">reset_clock</span><span class="p">()</span>

<span class="k">while</span> <span class="n">elapsed_time</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dond</span><span class="p">(</span><span class="n">sweep_1</span><span class="p">,</span> <span class="n">sweep_2</span><span class="p">,</span> <span class="n">dmm</span><span class="o">.</span><span class="n">v1</span><span class="p">,</span> <span class="n">additional_setpoints</span><span class="o">=</span><span class="p">(</span><span class="n">time_p</span><span class="p">,))</span>
    <span class="n">timed_datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time_p</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting experimental run with id: 205. Using &#39;qcodes.utils.dataset.doNd.dond&#39;
Starting experimental run with id: 206. Using &#39;qcodes.utils.dataset.doNd.dond&#39;
Starting experimental run with id: 207. Using &#39;qcodes.utils.dataset.doNd.dond&#39;
Starting experimental run with id: 208. Using &#39;qcodes.utils.dataset.doNd.dond&#39;
</pre></div></div>
</div>
<p>To visualize this lets merge the datasets using xarray</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">timed_xarray_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">to_xarray_dataset</span><span class="p">()</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">timed_datasets</span><span class="p">]</span>
<span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">timed_xarray_datasets</span><span class="p">)</span>
<span class="n">merged_dataset</span><span class="o">.</span><span class="n">dmm_v1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.plot.facetgrid.FacetGrid at 0x21280446f08&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_driver_examples_Qcodes_example_with_AMI430_54_1.png" src="../../_images/examples_driver_examples_Qcodes_example_with_AMI430_54_1.png" />
</div>
</div>
<p>Now, let’s do the same but while also ramping the magnetic field. We’ll use the <code class="docutils literal notranslate"><span class="pre">ramp_simultaneously</span></code> method here:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ramp_datasets</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Required for ``ramp_simultaneously`` to return</span>
<span class="c1"># immediately after initiating a ramp</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">block_during_ramp</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Assuming the field is in T and time in minutes</span>
<span class="n">i3d</span><span class="o">.</span><span class="n">ramp_simultaneously</span><span class="p">(</span><span class="n">setpoint</span><span class="o">=</span><span class="n">setpoint</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

<span class="n">time_p</span><span class="o">.</span><span class="n">reset_clock</span><span class="p">()</span>  <span class="c1"># Let&#39;s also store the elapsed time</span>

<span class="k">while</span> <span class="n">i3d</span><span class="o">.</span><span class="n">any_axis_is_ramping</span><span class="p">():</span>  <span class="c1"># Should be clear without additional explanation ;)</span>

    <span class="c1"># Run the 2D scan measurement</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dond</span><span class="p">(</span>
        <span class="n">sweep_1</span><span class="p">,</span> <span class="n">sweep_2</span><span class="p">,</span> <span class="n">dmm</span><span class="o">.</span><span class="n">v1</span><span class="p">,</span>
        <span class="n">additional_setpoints</span><span class="o">=</span><span class="p">(</span><span class="n">time_p</span><span class="p">,</span> <span class="n">ix</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="n">iy</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="n">iy</span><span class="o">.</span><span class="n">field</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Collect the dataset for later processing</span>
    <span class="n">ramp_datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

    <span class="c1"># Optionally, wait until the field changed sufficiently</span>
    <span class="c1"># enough for this measurement</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now the resulting <code class="docutils literal notranslate"><span class="pre">ramp_datasets</span></code> can be merged along time/field-x/field-y/field-z axes, as desired (see above), and used further, e.g. plotted.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="QCodes%20example%20with%20Tektronix%20DPO%2072004C.html" class="btn btn-neutral float-left" title="QCoDeS example with Textronix DPO 7200xx scopes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Qcodes%20example%20with%20Agilent%2034400A.html" class="btn btn-neutral float-right" title="QCoDeS Example with Agilent 34400A" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>