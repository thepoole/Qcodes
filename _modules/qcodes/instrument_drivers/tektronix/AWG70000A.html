<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qcodes.instrument_drivers.tektronix.AWG70000A &mdash; QCoDeS 0.30.0.dev0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link href="../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> QCoDeS
          </a>
              <div class="version">
                0.30.0.dev0+433.gef36c42fa
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../help.html">Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dataset/index.html">DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">QCoDes API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/generated/qcodes.instrument_drivers.html">qcodes.instrument_drivers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changes/index.html">Changelogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/index.html">Examples of using QCoDeS</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">QCoDeS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      <li>qcodes.instrument_drivers.tektronix.AWG70000A</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qcodes.instrument_drivers.tektronix.AWG70000A</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">zipfile</span> <span class="k">as</span> <span class="nn">zf</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">broadbean.sequence</span> <span class="kn">import</span> <span class="n">InvalidForgedSequenceError</span><span class="p">,</span> <span class="n">fs_schema</span>

<span class="kn">from</span> <span class="nn">qcodes</span> <span class="kn">import</span> <span class="n">Instrument</span><span class="p">,</span> <span class="n">VisaInstrument</span>
<span class="kn">from</span> <span class="nn">qcodes</span> <span class="kn">import</span> <span class="n">validators</span> <span class="k">as</span> <span class="n">vals</span>
<span class="kn">from</span> <span class="nn">qcodes.instrument.channel</span> <span class="kn">import</span> <span class="n">ChannelList</span><span class="p">,</span> <span class="n">InstrumentChannel</span>
<span class="kn">from</span> <span class="nn">qcodes.utils.validators</span> <span class="kn">import</span> <span class="n">Validator</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">##################################################</span>
<span class="c1">#</span>
<span class="c1"># SMALL HELPER FUNCTIONS</span>
<span class="c1">#</span>


<span class="k">def</span> <span class="nf">_parse_string_response</span><span class="p">(</span><span class="n">input_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove quotation marks from string and return &#39;N/A&#39;</span>
<span class="sd">    if the input is empty</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">input_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="k">if</span> <span class="n">output</span> <span class="k">else</span> <span class="s1">&#39;N/A&#39;</span>

    <span class="k">return</span> <span class="n">output</span>


<span class="c1">##################################################</span>
<span class="c1">#</span>
<span class="c1"># MODEL DEPENDENT SETTINGS</span>
<span class="c1">#</span>
<span class="c1"># TODO: it seems that a lot of settings differ between models</span>
<span class="c1"># perhaps these dicts should be merged to one</span>

<span class="n">_fg_path_val_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;5208&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;DC High BW&#39;</span><span class="p">:</span> <span class="s2">&quot;DCHB&quot;</span><span class="p">,</span>
                             <span class="s1">&#39;DC High Voltage&#39;</span><span class="p">:</span> <span class="s2">&quot;DCHV&quot;</span><span class="p">,</span>
                             <span class="s1">&#39;AC Direct&#39;</span><span class="p">:</span> <span class="s2">&quot;ACD&quot;</span><span class="p">},</span>
                    <span class="s1">&#39;70001A&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;direct&#39;</span><span class="p">:</span> <span class="s1">&#39;DIR&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;DCamplified&#39;</span><span class="p">:</span> <span class="s1">&#39;DCAM&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;AC&#39;</span><span class="p">:</span> <span class="s1">&#39;AC&#39;</span><span class="p">},</span>
                    <span class="s1">&#39;70002A&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;direct&#39;</span><span class="p">:</span> <span class="s1">&#39;DIR&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;DCamplified&#39;</span><span class="p">:</span> <span class="s1">&#39;DCAM&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;AC&#39;</span><span class="p">:</span> <span class="s1">&#39;AC&#39;</span><span class="p">},</span>
                    <span class="s1">&#39;70001B&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;direct&#39;</span><span class="p">:</span> <span class="s1">&#39;DIR&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;DCamplified&#39;</span><span class="p">:</span> <span class="s1">&#39;DCAM&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;AC&#39;</span><span class="p">:</span> <span class="s1">&#39;AC&#39;</span><span class="p">},</span>
                    <span class="s1">&#39;70002B&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;direct&#39;</span><span class="p">:</span> <span class="s1">&#39;DIR&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;DCamplified&#39;</span><span class="p">:</span> <span class="s1">&#39;DCAM&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;AC&#39;</span><span class="p">:</span> <span class="s1">&#39;AC&#39;</span><span class="p">}}</span>

<span class="c1"># number of markers per channel</span>
<span class="n">_num_of_markers_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;5208&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                       <span class="s1">&#39;70001A&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;70002A&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;70001B&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;70002B&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="c1"># channel resolution</span>
<span class="n">_chan_resolutions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;5208&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span>
                     <span class="s1">&#39;70001A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
                     <span class="s1">&#39;70002A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
                     <span class="s1">&#39;70001B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
                     <span class="s1">&#39;70002B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}</span>

<span class="c1"># channel resolution docstrings</span>
<span class="n">_chan_resolution_docstrings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;5208&#39;</span><span class="p">:</span> <span class="s2">&quot;12 bit resolution allows for four &quot;</span>
                                       <span class="s2">&quot;markers, 13 bit resolution &quot;</span>
                                       <span class="s2">&quot;allows for three, etc. with 16 bit &quot;</span>
                                       <span class="s2">&quot;allowing for ZERO markers&quot;</span><span class="p">,</span>
                               <span class="s1">&#39;70001A&#39;</span><span class="p">:</span> <span class="s2">&quot;8 bit resolution allows for two &quot;</span>
                                         <span class="s2">&quot;markers, 9 bit resolution &quot;</span>
                                         <span class="s2">&quot;allows for one, and 10 bit &quot;</span>
                                         <span class="s2">&quot;does NOT allow for markers &quot;</span><span class="p">,</span>
                               <span class="s1">&#39;70002A&#39;</span><span class="p">:</span> <span class="s2">&quot;8 bit resolution allows for two &quot;</span>
                                         <span class="s2">&quot;markers, 9 bit resolution &quot;</span>
                                         <span class="s2">&quot;allows for one, and 10 bit &quot;</span>
                                         <span class="s2">&quot;does NOT allow for markers &quot;</span><span class="p">,</span>
                               <span class="s1">&#39;70001B&#39;</span><span class="p">:</span> <span class="s2">&quot;8 bit resolution allows for two &quot;</span>
                                         <span class="s2">&quot;markers, 9 bit resolution &quot;</span>
                                         <span class="s2">&quot;allows for one, and 10 bit &quot;</span>
                                         <span class="s2">&quot;does NOT allow for markers &quot;</span><span class="p">,</span>
                               <span class="s1">&#39;70002B&#39;</span><span class="p">:</span> <span class="s2">&quot;8 bit resolution allows for two &quot;</span>
                                         <span class="s2">&quot;markers, 9 bit resolution &quot;</span>
                                         <span class="s2">&quot;allows for one, and 10 bit &quot;</span>
                                         <span class="s2">&quot;does NOT allow for markers &quot;</span><span class="p">}</span>

<span class="c1"># channel amplitudes</span>
<span class="n">_chan_amps</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;70001A&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
              <span class="s1">&#39;70002A&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
              <span class="s1">&#39;70001B&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
              <span class="s1">&#39;70002B&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
              <span class="s1">&#39;5208&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">}</span>

<span class="c1"># marker ranges</span>
<span class="n">_marker_high</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;70001A&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span>
                <span class="s1">&#39;70002A&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span>
                <span class="s1">&#39;70001B&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span>
                <span class="s1">&#39;70002B&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span>
                <span class="s1">&#39;5208&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">)}</span>
<span class="n">_marker_low</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;70001A&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span>
               <span class="s1">&#39;70002A&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span>
               <span class="s1">&#39;70001B&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span>
               <span class="s1">&#39;70002B&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span>
               <span class="s1">&#39;5208&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">)}</span>


<div class="viewcode-block" id="SRValidator"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.SRValidator">[docs]</a><span class="k">class</span> <span class="nc">SRValidator</span><span class="p">(</span><span class="n">Validator</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validator to validate the AWG clock sample rate</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">awg</span><span class="p">:</span> <span class="s1">&#39;AWG70000A&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            awg: The parent instrument instance. We need this since sample</span>
<span class="sd">                rate validation depends on many clock settings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awg</span> <span class="o">=</span> <span class="n">awg</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">awg</span><span class="o">.</span><span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;70001A&#39;</span><span class="p">,</span> <span class="s1">&#39;70001B&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_validator</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mf">1.49e3</span><span class="p">,</span> <span class="mf">50e9</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_freq_multiplier</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">awg</span><span class="o">.</span><span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;70002A&#39;</span><span class="p">,</span> <span class="s1">&#39;70002B&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_validator</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mf">1.49e3</span><span class="p">,</span> <span class="mf">25e9</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_freq_multiplier</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">awg</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;5208&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_validator</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mf">1.49e3</span><span class="p">,</span> <span class="mf">2.5e9</span><span class="p">)</span>
        <span class="c1"># no other models are possible, since the __init__ of</span>
        <span class="c1"># the AWG70000A raises an error if anything else is given</span>

<div class="viewcode-block" id="SRValidator.validate"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.SRValidator.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;Internal&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">awg</span><span class="o">.</span><span class="n">clock_source</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_validator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ext_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">awg</span><span class="o">.</span><span class="n">clock_external_frequency</span><span class="p">()</span>
            <span class="c1"># TODO: I&#39;m not sure what the minimal allowed sample rate is</span>
            <span class="c1"># in this case</span>
            <span class="n">validator</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mf">1.49e3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq_multiplier</span><span class="o">*</span><span class="n">ext_freq</span><span class="p">)</span>
            <span class="n">validator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AWGChannel"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWGChannel">[docs]</a><span class="k">class</span> <span class="nc">AWGChannel</span><span class="p">(</span><span class="n">InstrumentChannel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to hold a channel of the AWG.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">parent</span><span class="p">:</span> <span class="n">Instrument</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            parent: The Instrument instance to which the channel is</span>
<span class="sd">                to be attached.</span>
<span class="sd">            name: The name used in the DataSet</span>
<span class="sd">            channel: The channel number, either 1 or 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>

        <span class="n">num_channels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_instrument</span><span class="o">.</span><span class="n">num_channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_instrument</span><span class="o">.</span><span class="n">model</span>

        <span class="n">fg</span> <span class="o">=</span> <span class="s1">&#39;function generator&#39;</span>

        <span class="k">if</span> <span class="n">channel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_channels</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal channel value.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> state&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;OUTPut</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:STATe?&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;OUTPut</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:STATe </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Ints</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1">##################################################</span>
        <span class="c1"># FGEN PARAMETERS</span>

        <span class="c1"># TODO: Setting high and low will change this parameter&#39;s value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_amplitude&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> amplitude&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:AMPLitude?&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:AMPLitude </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_chan_amps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">]),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_offset&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> offset&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:OFFSet?&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:OFFSet </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">),</span>  <span class="c1"># depends on ampl.</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_frequency&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> frequency&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:FREQuency?&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_fgfreq</span><span class="p">,</span> <span class="n">channel</span><span class="p">),</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_dclevel&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> DC level&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:DCLevel?&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:DCLevel </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_signalpath&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> signal path&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:PATH </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:PATH?&#39;</span><span class="p">,</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="n">_fg_path_val_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root_instrument</span><span class="o">.</span><span class="n">model</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_period&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> period&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:PERiod?&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_phase&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> phase&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:PHASe?&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:PHASe </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_symmetry&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> symmetry&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:SYMMetry </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:SYMMetry?&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;fgen_type&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">fg</span><span class="si">}</span><span class="s1"> type&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:TYPE </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:TYPE?&#39;</span><span class="p">,</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SINE&#39;</span><span class="p">:</span> <span class="s1">&#39;SINE&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;SQUARE&#39;</span><span class="p">:</span> <span class="s1">&#39;SQU&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;TRIANGLE&#39;</span><span class="p">:</span> <span class="s1">&#39;TRI&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;NOISE&#39;</span><span class="p">:</span> <span class="s1">&#39;NOIS&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;DC&#39;</span><span class="p">:</span> <span class="s1">&#39;DC&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">:</span> <span class="s1">&#39;GAUSS&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;EXPONENTIALRISE&#39;</span><span class="p">:</span> <span class="s1">&#39;EXPR&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;EXPONENTIALDECAY&#39;</span><span class="p">:</span> <span class="s1">&#39;EXPD&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;NONE&#39;</span><span class="p">:</span> <span class="s1">&#39;NONE&#39;</span><span class="p">})</span>

        <span class="c1">##################################################</span>
        <span class="c1"># AWG PARAMETERS</span>

        <span class="c1"># this command internally uses power in dBm</span>
        <span class="c1"># the manual claims that this command only works in AC mode</span>
        <span class="c1"># (OUTPut[n]:PATH is AC), but I&#39;ve tested that it does what</span>
        <span class="c1"># one would expect in DIR mode.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
            <span class="s1">&#39;awg_amplitude&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> AWG peak-to-peak amplitude&#39;</span><span class="p">,</span>
            <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SOURCe</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:VOLTage </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SOURce</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:VOLTage?&#39;</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
            <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mf">0.250</span><span class="p">,</span> <span class="n">_chan_amps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;assigned_asset&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Waveform/sequence assigned to &#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39; channel </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SOURCE</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="si">}</span><span class="s2">:CASSet?&quot;</span><span class="p">,</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="n">_parse_string_response</span><span class="p">)</span>

        <span class="c1"># markers</span>
        <span class="k">for</span> <span class="n">mrk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">_num_of_markers_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;marker</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1">_high&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> marker </span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1"> high level&#39;</span><span class="p">,</span>
                <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">mrk</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SOURce</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:MARKer</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1">:VOLTage:HIGH?&#39;</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="o">*</span><span class="n">_marker_high</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">]),</span>
                <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;marker</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1">_low&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> marker </span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1"> low level&#39;</span><span class="p">,</span>
                <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_marker</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">mrk</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SOURce</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:MARKer</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1">:VOLTage:LOW?&#39;</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="o">*</span><span class="n">_marker_low</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">]),</span>
                <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;marker</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1">_waitvalue&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> marker </span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1"> wait state&#39;</span><span class="p">,</span>
                <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;OUTPut</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:WVALue:MARKer</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1"> </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;OUTPut</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:WVALue:MARKer</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1">?&#39;</span><span class="p">,</span>
                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;FIRST&#39;</span><span class="p">,</span> <span class="s1">&#39;LOW&#39;</span><span class="p">,</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;marker</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1">_stoppedvalue&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> marker </span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1"> stopped value&#39;</span><span class="p">,</span>
                <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;OUTPut</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:SVALue:MARKer</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1"> </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;OUTPut</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:SVALue:MARKer</span><span class="si">{</span><span class="n">mrk</span><span class="si">}</span><span class="s1">?&#39;</span><span class="p">,</span>
                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;OFF&#39;</span><span class="p">,</span> <span class="s1">&#39;LOW&#39;</span><span class="p">))</span>

        <span class="c1">##################################################</span>
        <span class="c1"># MISC.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1"> bit resolution&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SOURce</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:DAC:RESolution?&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SOURce</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:DAC:RESolution </span><span class="se">{{}}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="n">_chan_resolutions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">]),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="n">_chan_resolution_docstrings</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">marker</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">high</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">voltage</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the marker high/low value and update the low/high value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">high</span><span class="p">:</span>
            <span class="n">this</span> <span class="o">=</span> <span class="s1">&#39;HIGH&#39;</span>
            <span class="n">other</span> <span class="o">=</span> <span class="s1">&#39;low&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">this</span> <span class="o">=</span> <span class="s1">&#39;LOW&#39;</span>
            <span class="n">other</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SOURce</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:MARKer</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s1">:VOLTage:</span><span class="si">{</span><span class="n">this</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">voltage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;marker</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_fgfreq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">frequency</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the function generator frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">functype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fgen_type</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">functype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SINE&#39;</span><span class="p">,</span> <span class="s1">&#39;SQUARE&#39;</span><span class="p">]:</span>
            <span class="n">max_freq</span> <span class="o">=</span> <span class="mf">12.5e9</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_freq</span> <span class="o">=</span> <span class="mf">6.25e9</span>

        <span class="c1"># validate</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">frequency</span> <span class="o">&gt;</span> <span class="n">max_freq</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not set channel </span><span class="si">{}</span><span class="s1"> frequency to </span><span class="si">{}</span><span class="s1"> Hz.&#39;</span>
                             <span class="s1">&#39; Maximum frequency for function type </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1"> &#39;</span>
                             <span class="s1">&#39;Hz, minimum is 1 Hz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span>
                                                          <span class="n">functype</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_instrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FGEN:CHANnel</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s1">:&#39;</span>
                                       <span class="sa">f</span><span class="s1">&#39;FREQuency </span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="AWGChannel.setWaveform"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWGChannel.setWaveform">[docs]</a>    <span class="k">def</span> <span class="nf">setWaveform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a waveform from the waveform list to output on this channel</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the waveform</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_instrument</span><span class="o">.</span><span class="n">waveformList</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No such waveform in the waveform list&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_instrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SOURce</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="si">}</span><span class="s1">:CASSet:WAVeform &quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWGChannel.setSequenceTrack"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWGChannel.setSequenceTrack">[docs]</a>    <span class="k">def</span> <span class="nf">setSequenceTrack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tracknr</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign a track from a sequence to this channel.</span>

<span class="sd">        Args:</span>
<span class="sd">            seqname: Name of the sequence in the sequence list</span>
<span class="sd">            tracknr: Which track to use (1 or 2)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_instrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SOURCE</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="si">}</span><span class="s1">:&#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;CASSet:SEQuence &quot;</span><span class="si">{</span><span class="n">seqname</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;, </span><span class="si">{</span><span class="n">tracknr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AWG70000A"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A">[docs]</a><span class="k">class</span> <span class="nc">AWG70000A</span><span class="p">(</span><span class="n">VisaInstrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The QCoDeS driver for Tektronix AWG70000A series AWG&#39;s.</span>

<span class="sd">    The drivers for AWG70001A/AWG70001B and AWG70002A/AWG70002B should be</span>
<span class="sd">    subclasses of this general class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_channels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name used internally by QCoDeS in the DataSet</span>
<span class="sd">            address: The VISA resource name of the instrument</span>
<span class="sd">            timeout: The VISA timeout time (in seconds)</span>
<span class="sd">            num_channels: Number of channels on the AWG</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">=</span> <span class="n">num_channels</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">terminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># The &#39;model&#39; value begins with &#39;AWG&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDN</span><span class="p">()[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;70001A&#39;</span><span class="p">,</span> <span class="s1">&#39;70002A&#39;</span><span class="p">,</span> <span class="s1">&#39;70001B&#39;</span><span class="p">,</span> <span class="s1">&#39;70002B&#39;</span><span class="p">,</span> <span class="s1">&#39;5208&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown model type: </span><span class="si">{}</span><span class="s1">. Are you using &#39;</span>
                             <span class="s1">&#39;the right driver for your instrument?&#39;</span>
                             <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;current_directory&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Current file system directory&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="s1">&#39;MMEMory:CDIRectory &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="s1">&#39;MMEMory:CDIRectory?&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Strings</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Instrument operation mode&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="s1">&#39;INSTrument:MODE </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="s1">&#39;INSTrument:MODE?&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;AWG&#39;</span><span class="p">,</span> <span class="s1">&#39;FGEN&#39;</span><span class="p">))</span>

        <span class="c1">##################################################</span>
        <span class="c1"># Clock parameters</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sample_rate&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Clock sample rate&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="s1">&#39;CLOCk:SRATe </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="s1">&#39;CLOCk:SRATe?&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Sa/s&#39;</span><span class="p">,</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">SRValidator</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;clock_source&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Clock source&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="s1">&#39;CLOCk:SOURce </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="s1">&#39;CLOCk:SOURce?&#39;</span><span class="p">,</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Internal&#39;</span><span class="p">:</span> <span class="s1">&#39;INT&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;Internal, 10 MHZ ref.&#39;</span><span class="p">:</span> <span class="s1">&#39;EFIX&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;Internal, variable ref.&#39;</span><span class="p">:</span> <span class="s1">&#39;EVAR&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;External&#39;</span><span class="p">:</span> <span class="s1">&#39;EXT&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;clock_external_frequency&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;External clock frequency&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="s1">&#39;CLOCk:ECLock:FREQuency </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="s1">&#39;CLOCk:ECLock:FREQuency?&#39;</span><span class="p">,</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mf">6.25e9</span><span class="p">,</span> <span class="mf">12.5e9</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;run_state&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Run state&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="s1">&#39;AWGControl:RSTATe?&#39;</span><span class="p">,</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Stopped&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;Waiting for trigger&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;Running&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">})</span>

        <span class="c1"># We deem 2 channels too few for a channel list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">chanlist</span> <span class="o">=</span> <span class="n">ChannelList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Channels&#39;</span><span class="p">,</span> <span class="n">AWGChannel</span><span class="p">,</span>
                                   <span class="n">snapshotable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ch_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_channels</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">ch_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ch</span><span class="si">{</span><span class="n">ch_num</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">AWGChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ch_name</span><span class="p">,</span> <span class="n">ch_num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_submodule</span><span class="p">(</span><span class="n">ch_name</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">chanlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">chanlist</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_submodule</span><span class="p">(</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">chanlist</span><span class="p">)</span>

        <span class="c1"># Folder on the AWG where to files are uplaoded by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfmxFileFolder</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">OEM</span><span class="se">\\</span><span class="s2">Documents&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seqxFileFolder</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">OEM</span><span class="se">\\</span><span class="s2">Documents&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wfmxFileFolder</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_message</span><span class="p">()</span>

<div class="viewcode-block" id="AWG70000A.force_triggerA"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.force_triggerA">[docs]</a>    <span class="k">def</span> <span class="nf">force_triggerA</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Force a trigger A event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;TRIGger:IMMediate ATRigger&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.force_triggerB"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.force_triggerB">[docs]</a>    <span class="k">def</span> <span class="nf">force_triggerB</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Force a trigger B event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;TRIGger:IMMediate BTRigger&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.wait_for_operation_to_complete"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.wait_for_operation_to_complete">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_operation_to_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits for the latest issued overlapping command to finish</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s1">&#39;*OPC?&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.play"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.play">[docs]</a>    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wait_for_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the AWG/Func. Gen. This command is equivalent to pressing the</span>
<span class="sd">        play button on the front panel.</span>

<span class="sd">        Args:</span>
<span class="sd">            wait_for_running: If True, this command is blocking while the</span>
<span class="sd">                instrument is getting ready to play</span>
<span class="sd">            timeout: The maximal time to wait for the instrument to play.</span>
<span class="sd">                Raises an exception is this time is reached.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;AWGControl:RUN&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wait_for_running</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
            <span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">running</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="n">running</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_state</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Running&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;Waiting for trigger&#39;</span><span class="p">)</span>
                <span class="n">waited_for</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">waited_for</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reached timeout (</span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s1"> s) &#39;</span>
                                       <span class="s1">&#39;while waiting for instrument to play.&#39;</span>
                                       <span class="s1">&#39; Perhaps some waveform or sequence is&#39;</span>
                                       <span class="s1">&#39; corrupt?&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.stop"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the output of the instrument. This command is equivalent to</span>
<span class="sd">        pressing the stop button on the front panel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;AWGControl:STOP&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sequenceList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the sequence list as a list of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># There is no SLISt:LIST command, so we do it slightly differently</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s2">&quot;SLISt:SIZE?&quot;</span><span class="p">))</span>
        <span class="n">slist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SLISt:NAME? </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">slist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">slist</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">waveformList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the waveform list as a list of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">respstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s2">&quot;WLISt:LIST?&quot;</span><span class="p">)</span>
        <span class="n">respstr</span> <span class="o">=</span> <span class="n">respstr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">respstr</span> <span class="o">=</span> <span class="n">respstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">respstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">resp</span>

<div class="viewcode-block" id="AWG70000A.delete_sequence_from_list"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.delete_sequence_from_list">[docs]</a>    <span class="k">def</span> <span class="nf">delete_sequence_from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the specified sequence from the sequence list</span>

<span class="sd">        Args:</span>
<span class="sd">            seqname: The name of the sequence (as it appears in the sequence</span>
<span class="sd">                list, not the file name) to delete</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SLISt:SEQuence:DELete &quot;</span><span class="si">{</span><span class="n">seqname</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.clearSequenceList"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.clearSequenceList">[docs]</a>    <span class="k">def</span> <span class="nf">clearSequenceList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear the sequence list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SLISt:SEQuence:DELete ALL&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.clearWaveformList"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.clearWaveformList">[docs]</a>    <span class="k">def</span> <span class="nf">clearWaveformList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear the waveform list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WLISt:WAVeform:DELete ALL&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.makeWFMXFile"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.makeWFMXFile">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">makeWFMXFile</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compose a WFMX file</span>

<span class="sd">        Args:</span>
<span class="sd">            data: A numpy array holding the data. Markers can be included.</span>
<span class="sd">            amplitude: The peak-to-peak amplitude (V) assumed to be set on the</span>
<span class="sd">                channel that will play this waveform. This information is</span>
<span class="sd">                needed as the waveform must be rescaled to (-1, 1) where</span>
<span class="sd">                -1 will correspond to the channel&#39;s min. voltage and 1 to the</span>
<span class="sd">                channel&#39;s max. voltage.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The binary .wfmx file, ready to be sent to the instrument.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">markers_included</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">markers_included</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input data has too many dimensions!&#39;</span><span class="p">)</span>

        <span class="n">wfmx_hdr_str</span> <span class="o">=</span> <span class="n">AWG70000A</span><span class="o">.</span><span class="n">_makeWFMXFileHeader</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="n">N</span><span class="p">,</span>
                                                     <span class="n">markers_included</span><span class="o">=</span><span class="n">markers_included</span><span class="p">)</span>
        <span class="n">wfmx_hdr</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">wfmx_hdr_str</span><span class="p">,</span> <span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="n">wfmx_data</span> <span class="o">=</span> <span class="n">AWG70000A</span><span class="o">.</span><span class="n">_makeWFMXFileBinaryData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">)</span>

        <span class="n">wfmx</span> <span class="o">=</span> <span class="n">wfmx_hdr</span>

        <span class="n">wfmx</span> <span class="o">+=</span> <span class="n">wfmx_data</span>

        <span class="k">return</span> <span class="n">wfmx</span></div>

<div class="viewcode-block" id="AWG70000A.sendSEQXFile"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.sendSEQXFile">[docs]</a>    <span class="k">def</span> <span class="nf">sendSEQXFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqx</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a binary seqx file to the AWG&#39;s memory</span>

<span class="sd">        Args:</span>
<span class="sd">            seqx: The binary seqx file, preferably the output of</span>
<span class="sd">                makeSEQXFile.</span>
<span class="sd">            filename: The name of the file on the AWG disk, including the</span>
<span class="sd">                extension.</span>
<span class="sd">            path: The path to the directory where the file should be saved. If</span>
<span class="sd">                omitted, seqxFileFolder will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqxFileFolder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sendBinaryFile</span><span class="p">(</span><span class="n">seqx</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.sendWFMXFile"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.sendWFMXFile">[docs]</a>    <span class="k">def</span> <span class="nf">sendWFMXFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wfmx</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a binary wfmx file to the AWG&#39;s memory</span>

<span class="sd">        Args:</span>
<span class="sd">            wfmx: The binary wfmx file, preferably the output of</span>
<span class="sd">                makeWFMXFile.</span>
<span class="sd">            filename: The name of the file on the AWG disk, including the</span>
<span class="sd">                extension.</span>
<span class="sd">            path: The path to the directory where the file should be saved. If</span>
<span class="sd">                omitted, seqxFileFolder will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wfmxFileFolder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sendBinaryFile</span><span class="p">(</span><span class="n">wfmx</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_sendBinaryFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binfile</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a binary file to the AWG&#39;s mass memory (disk).</span>

<span class="sd">        Args:</span>
<span class="sd">            binfile: The binary file to send.</span>
<span class="sd">            filename: The name of the file on the AWG disk, including the</span>
<span class="sd">                extension.</span>
<span class="sd">            path: The path to the directory where the file should be saved.</span>
<span class="sd">            overwrite: If true, the file on disk gets overwritten</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">name_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;MMEMory:DATA &quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="n">len_file</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">binfile</span><span class="p">)</span>
        <span class="n">len_str</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">len_file</span><span class="p">))</span>  <span class="c1"># No. of digits needed to write length</span>
        <span class="n">size_str</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;,#</span><span class="si">{</span><span class="n">len_str</span><span class="si">}{</span><span class="n">len_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">name_str</span> <span class="o">+</span> <span class="n">size_str</span> <span class="o">+</span> <span class="n">binfile</span>

        <span class="c1"># IEEE 488.2 limit on a single write is 999,999,999 bytes</span>
        <span class="c1"># TODO: If this happens, we should split the file</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e9</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;File too large to transfer&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pre-deleting file </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visa_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MMEMory:DELete &quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="c1"># if the file does not exist,</span>
            <span class="c1"># an error code -256 is put in the error queue</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visa_handle</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SYSTem:ERRor:CODE?&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pre-deletion finished with return code </span><span class="si">{</span><span class="n">resp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visa_handle</span><span class="o">.</span><span class="n">write_raw</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<div class="viewcode-block" id="AWG70000A.loadWFMXFile"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.loadWFMXFile">[docs]</a>    <span class="k">def</span> <span class="nf">loadWFMXFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a wfmx from memory into the waveform list</span>
<span class="sd">        Only loading from the C: drive is supported</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Name of the file (with extension)</span>
<span class="sd">            path: Path to load from. If omitted, the default path</span>
<span class="sd">                (self.wfmxFileFolder) is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wfmxFileFolder</span>

        <span class="n">pathstr</span> <span class="o">=</span> <span class="s1">&#39;C:&#39;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MMEMory:OPEN &quot;</span><span class="si">{</span><span class="n">pathstr</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="c1"># the above command is overlapping, but we want a blocking command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s2">&quot;*OPC?&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AWG70000A.loadSEQXFile"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.loadSEQXFile">[docs]</a>    <span class="k">def</span> <span class="nf">loadSEQXFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a seqx file from instrument disk memory. All sequences in the file</span>
<span class="sd">        are loaded into the sequence list.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: The name of the sequence file INCLUDING the extension</span>
<span class="sd">            path: Path to load from. If omitted, the default path</span>
<span class="sd">                (self.seqxFileFolder) is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqxFileFolder</span>

        <span class="n">pathstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;C:</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MMEMory:OPEN:SASSet:SEQuence &quot;</span><span class="si">{</span><span class="n">pathstr</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="c1"># the above command is overlapping, but we want a blocking command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s1">&#39;*OPC?&#39;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_makeWFMXFileHeader</span><span class="p">(</span><span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">markers_included</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compiles a valid XML header for a .wfmx file</span>
<span class="sd">        There might be behaviour we can&#39;t capture</span>

<span class="sd">        We always use 9 digits for the number of header character</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offsetdigits</span> <span class="o">=</span> <span class="mi">9</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;num_samples must be of type int.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_samples</span> <span class="o">&lt;</span> <span class="mi">2400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;num_samples must be at least 2400.&#39;</span><span class="p">)</span>

        <span class="c1"># form the timestamp string</span>
        <span class="n">timezone</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span>
        <span class="n">tz_m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">timezone</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># returns (minutes, seconds)</span>
        <span class="n">tz_h</span><span class="p">,</span> <span class="n">tz_m</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">tz_m</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">tz_h</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">signstr</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
            <span class="n">tz_h</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signstr</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
        <span class="n">timestr</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">timestr</span> <span class="o">+=</span> <span class="n">signstr</span>
        <span class="n">timestr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tz_h</span><span class="si">:</span><span class="s1">02.0f</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">tz_m</span><span class="si">:</span><span class="s1">02.0f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">hdr</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;DataFile&#39;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="o">*</span><span class="n">offsetdigits</span><span class="p">,</span>
                                             <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;0.1&#39;</span><span class="p">})</span>
        <span class="n">dsc</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="s1">&#39;DataSetsCollection&#39;</span><span class="p">)</span>
        <span class="n">dsc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;xmlns&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.tektronix.com&quot;</span><span class="p">)</span>
        <span class="n">dsc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;xmlns:xsi&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="p">)</span>
        <span class="n">dsc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;xsi:schemaLocation&quot;</span><span class="p">,</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;http://www.tektronix.com file:///&quot;</span> <span class="o">+</span>
                                       <span class="sa">r</span><span class="s2">&quot;C:\Program</span><span class="si">%20F</span><span class="s2">iles\Tektronix\AWG70000&quot;</span> <span class="o">+</span>
                                       <span class="sa">r</span><span class="s2">&quot;\AWG\Schemas\awgDataSets.xsd&quot;</span><span class="p">))</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">dsc</span><span class="p">,</span> <span class="s1">&#39;DataSets&#39;</span><span class="p">)</span>
        <span class="n">datasets</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="n">datasets</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;xmlns&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.tektronix.com&quot;</span><span class="p">)</span>

        <span class="c1"># Description of the data</span>
        <span class="n">datadesc</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s1">&#39;DataDescription&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;NumberSamples&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">num_samples</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;SamplesType&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;AWGWaveformSample&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;MarkersIncluded&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">markers_included</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;NumberFormat&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Single&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;Endian&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Little&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;Timestamp&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">timestr</span>

        <span class="c1"># Product specific information</span>
        <span class="n">prodspec</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s1">&#39;ProductSpecific&#39;</span><span class="p">)</span>
        <span class="n">prodspec</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;ReccSamplingRate&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;NaN&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;ReccAmplitude&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;Volts&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;NaN&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;ReccOffset&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;Volts&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;NaN&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;SerialNumber&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;SoftwareVersion&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;1.0.0917&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;UserNotes&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;OriginalBitDepth&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Floating&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;Thumbnail&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;CreatorProperties&#39;</span><span class="p">,</span>
                          <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="s1">&#39;Setup&#39;</span><span class="p">)</span>

        <span class="n">xmlstr</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span>
        <span class="n">xmlstr</span> <span class="o">=</span> <span class="n">xmlstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;</span><span class="se">\r\n</span><span class="s1">&lt;&#39;</span><span class="p">)</span>

        <span class="c1"># As the final step, count the length of the header and write this</span>
        <span class="c1"># in the DataFile tag attribute &#39;offset&#39;</span>

        <span class="n">xmlstr</span> <span class="o">=</span> <span class="n">xmlstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="o">*</span><span class="n">offsetdigits</span><span class="p">,</span>
                                <span class="s1">&#39;{num:0</span><span class="si">{pad}</span><span class="s1">d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xmlstr</span><span class="p">),</span>
                                                       <span class="n">pad</span><span class="o">=</span><span class="n">offsetdigits</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">xmlstr</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_makeWFMXFileBinaryData</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For the binary part.</span>

<span class="sd">        Note that currently only zero markers or two markers are supported;</span>
<span class="sd">        one-marker data will break.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Either a shape (N,) array with only a waveform or</span>
<span class="sd">                a shape (M, N) array with waveform, marker1, marker2, marker3, i.e.</span>
<span class="sd">                data = np.array([wfm, m1, ...]). The waveform data is assumed</span>
<span class="sd">                to be in V.</span>
<span class="sd">            amplitude: The peak-to-peak amplitude (V) assumed to be set on the</span>
<span class="sd">                channel that will play this waveform. This information is</span>
<span class="sd">                needed as the waveform must be rescaled to (-1, 1) where</span>
<span class="sd">                -1 will correspond to the channel&#39;s min. voltage and 1 to the</span>
<span class="sd">                channel&#39;s max. voltage.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">channel_max</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">channel_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">amplitude</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">binary_marker</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
            <span class="n">wfm</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">wfm</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">markers</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="s1">&#39;B&#39;</span>  <span class="c1"># endian-ness doesn&#39;t matter for one byte</span>
            <span class="n">binary_marker</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">markers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wfm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">channel_max</span> <span class="ow">or</span> <span class="n">wfm</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">channel_min</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Waveform exceeds specified channel range.&#39;</span>
                        <span class="s1">&#39; The resulting waveform will be clipped. &#39;</span>
                        <span class="s1">&#39;Waveform min.: </span><span class="si">{}</span><span class="s1"> (V), waveform max.: </span><span class="si">{}</span><span class="s1"> (V),&#39;</span>
                        <span class="s1">&#39;Channel min.: </span><span class="si">{}</span><span class="s1"> (V), channel max.: </span><span class="si">{}</span><span class="s1"> (V)&#39;</span>
                        <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wfm</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">wfm</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">channel_min</span><span class="p">,</span>
                                  <span class="n">channel_max</span><span class="p">))</span>

        <span class="c1"># the data must be such that channel_max becomes 1 and</span>
        <span class="c1"># channel_min becomes -1</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="n">amplitude</span>
        <span class="n">wfm</span> <span class="o">=</span> <span class="n">wfm</span><span class="o">*</span><span class="n">scale</span>

        <span class="c1"># TODO: Is this a fast method?</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">N</span><span class="o">*</span><span class="s1">&#39;f&#39;</span>
        <span class="n">binary_wfm</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">wfm</span><span class="p">)</span>
        <span class="n">binary_out</span> <span class="o">=</span> <span class="n">binary_wfm</span> <span class="o">+</span> <span class="n">binary_marker</span>

        <span class="k">return</span> <span class="n">binary_out</span>

<div class="viewcode-block" id="AWG70000A.make_SEQX_from_forged_sequence"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.make_SEQX_from_forged_sequence">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">make_SEQX_from_forged_sequence</span><span class="p">(</span>
            <span class="n">seq</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
            <span class="n">amplitudes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
            <span class="n">seqname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">channel_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a .seqx from a forged broadbean sequence.</span>
<span class="sd">        Supports subsequences.</span>

<span class="sd">        Args:</span>
<span class="sd">            seq: The output of broadbean&#39;s Sequence.forge()</span>
<span class="sd">            amplitudes: A list of the AWG channels&#39; voltage amplitudes.</span>
<span class="sd">                The first entry is ch1 etc.</span>
<span class="sd">            channel_mapping: A mapping from what the channel is called</span>
<span class="sd">                in the broadbean sequence to the integer describing the</span>
<span class="sd">                physical channel it should be assigned to.</span>
<span class="sd">            seqname: The name that the sequence will have in the AWG&#39;s</span>
<span class="sd">                sequence list. Used for loading the sequence.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The binary .seqx file contents. Can be sent directly to the</span>
<span class="sd">                instrument or saved on disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">fs_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidForgedSequenceError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">chan_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pos1</span> <span class="ow">in</span> <span class="n">seq</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pos2</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="n">pos2</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">ch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chan_list</span><span class="p">:</span>
                        <span class="n">chan_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">channel_mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channel_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">ch</span><span class="p">:</span> <span class="n">ch_ind</span><span class="o">+</span><span class="mi">1</span>
                               <span class="k">for</span> <span class="n">ch_ind</span><span class="p">,</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chan_list</span><span class="p">)}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chan_list</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect number of amplitudes provided.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">chan_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid channel_mapping. The sequence has &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;channels </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">chan_list</span><span class="p">)</span><span class="si">}</span><span class="s1">, but the &#39;</span>
                             <span class="s1">&#39;channel_mapping maps from the channels &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">channel_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">chan_list</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid channel_mapping. Must map onto &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">chan_list</span><span class="p">)))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">##########</span>
        <span class="c1"># STEP 1:</span>
        <span class="c1"># Make all .wfmx files</span>

        <span class="n">wfmx_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wfmx_filenames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">pos1</span> <span class="ow">in</span> <span class="n">seq</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pos2</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="n">pos2</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">wfm</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;wfm&#39;</span><span class="p">]</span>

                    <span class="n">markerdata</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">mkey</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;m1&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;m4&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">mkey</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">markerdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mkey</span><span class="p">))</span>
                    <span class="n">wfm_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">wfm</span><span class="p">,</span> <span class="o">*</span><span class="n">markerdata</span><span class="p">))</span>

                    <span class="n">awgchan</span> <span class="o">=</span> <span class="n">channel_mapping</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span>
                    <span class="n">wfmx</span> <span class="o">=</span> <span class="n">AWG70000A</span><span class="o">.</span><span class="n">makeWFMXFile</span><span class="p">(</span><span class="n">wfm_data</span><span class="p">,</span>
                                                  <span class="n">amplitudes</span><span class="p">[</span><span class="n">awgchan</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">wfmx_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wfmx</span><span class="p">)</span>
                    <span class="n">wfmx_filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wfm_</span><span class="si">{</span><span class="n">pos1</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">pos2</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">awgchan</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">##########</span>
        <span class="c1"># STEP 2:</span>
        <span class="c1"># Make all subsequence .sml files</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Waveforms done: </span><span class="si">{</span><span class="n">wfmx_filenames</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">subseqsml_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subseqsml_filenames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">pos1</span> <span class="ow">in</span> <span class="n">seq</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;subsequence&#39;</span><span class="p">:</span>

                <span class="n">ss_wfm_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># we need to &quot;flatten&quot; all the individual dicts of element</span>
                <span class="c1"># sequence options into one dict of lists of sequencing options</span>
                <span class="c1"># and we must also provide default values if nothing</span>
                <span class="c1"># is specified</span>
                <span class="n">seqings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">pos2</span> <span class="ow">in</span> <span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">pos_seqs</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="n">pos2</span><span class="p">][</span><span class="s1">&#39;sequencing&#39;</span><span class="p">]</span>
                    <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;twait&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;twait&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;nrep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nrep&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;jump_input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jump_input&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;jump_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jump_target&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;goto&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">seqings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_seqs</span><span class="p">)</span>

                    <span class="n">ss_wfm_names</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">wfmx_filenames</span>
                                         <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;wfm_</span><span class="si">{</span><span class="n">pos1</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">pos2</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="p">])</span>

                <span class="n">seqing</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">seqings</span><span class="p">]</span>
                          <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">seqings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

                <span class="n">subseqname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;subsequence_</span><span class="si">{</span><span class="n">pos1</span><span class="si">}</span><span class="s1">&#39;</span>

                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Subsequence waveform names: </span><span class="si">{</span><span class="n">ss_wfm_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="n">subseqsml</span> <span class="o">=</span> <span class="n">AWG70000A</span><span class="o">.</span><span class="n">_makeSMLFile</span><span class="p">(</span><span class="n">trig_waits</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;twait&#39;</span><span class="p">],</span>
                                                   <span class="n">nreps</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;nrep&#39;</span><span class="p">],</span>
                                                   <span class="n">event_jumps</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;jump_input&#39;</span><span class="p">],</span>
                                                   <span class="n">event_jump_to</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;jump_target&#39;</span><span class="p">],</span>
                                                   <span class="n">go_to</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;goto&#39;</span><span class="p">],</span>
                                                   <span class="n">elem_names</span><span class="o">=</span><span class="n">ss_wfm_names</span><span class="p">,</span>
                                                   <span class="n">seqname</span><span class="o">=</span><span class="n">subseqname</span><span class="p">,</span>
                                                   <span class="n">chans</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">channel_mapping</span><span class="p">))</span>

                <span class="n">subseqsml_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subseqsml</span><span class="p">)</span>
                <span class="n">subseqsml_filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subseqname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">##########</span>
        <span class="c1"># STEP 3:</span>
        <span class="c1"># Make the main .sml file</span>

        <span class="n">asset_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seqings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subseq_positions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pos1</span> <span class="ow">in</span> <span class="n">seq</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">pos_seqs</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;sequencing&#39;</span><span class="p">]</span>

            <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;twait&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;twait&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;nrep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nrep&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;jump_input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jump_input&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;jump_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jump_target&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">pos_seqs</span><span class="p">[</span><span class="s1">&#39;goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_seqs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;goto&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">seqings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_seqs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="n">pos1</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;subsequence&#39;</span><span class="p">:</span>
                <span class="n">subseq_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos1</span><span class="p">)</span>
                <span class="n">asset_names</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">sn</span> <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">subseqsml_filenames</span>
                                    <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">pos1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">sn</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">asset_names</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">wn</span> <span class="k">for</span> <span class="n">wn</span> <span class="ow">in</span> <span class="n">wfmx_filenames</span>
                                    <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;wfm_</span><span class="si">{</span><span class="n">pos1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">wn</span><span class="p">])</span>
        <span class="n">seqing</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">seqings</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">seqings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Assets for SML file: </span><span class="si">{</span><span class="n">asset_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">mainseqname</span> <span class="o">=</span> <span class="n">seqname</span>
        <span class="n">mainseqsml</span> <span class="o">=</span> <span class="n">AWG70000A</span><span class="o">.</span><span class="n">_makeSMLFile</span><span class="p">(</span><span class="n">trig_waits</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;twait&#39;</span><span class="p">],</span>
                                            <span class="n">nreps</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;nrep&#39;</span><span class="p">],</span>
                                            <span class="n">event_jumps</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;jump_input&#39;</span><span class="p">],</span>
                                            <span class="n">event_jump_to</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;jump_target&#39;</span><span class="p">],</span>
                                            <span class="n">go_to</span><span class="o">=</span><span class="n">seqing</span><span class="p">[</span><span class="s1">&#39;goto&#39;</span><span class="p">],</span>
                                            <span class="n">elem_names</span><span class="o">=</span><span class="n">asset_names</span><span class="p">,</span>
                                            <span class="n">seqname</span><span class="o">=</span><span class="n">mainseqname</span><span class="p">,</span>
                                            <span class="n">chans</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">channel_mapping</span><span class="p">),</span>
                                            <span class="n">subseq_positions</span><span class="o">=</span><span class="n">subseq_positions</span><span class="p">)</span>

        <span class="c1">##########</span>
        <span class="c1"># STEP 4:</span>
        <span class="c1"># Build the .seqx file</span>

        <span class="n">user_file</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="n">setup_file</span> <span class="o">=</span> <span class="n">AWG70000A</span><span class="o">.</span><span class="n">_makeSetupFile</span><span class="p">(</span><span class="n">mainseqname</span><span class="p">)</span>

        <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>

        <span class="n">zipfile</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ssn</span><span class="p">,</span> <span class="n">ssf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subseqsml_filenames</span><span class="p">,</span> <span class="n">subseqsml_files</span><span class="p">):</span>
            <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sequences/</span><span class="si">{</span><span class="n">ssn</span><span class="si">}</span><span class="s1">.sml&#39;</span><span class="p">,</span> <span class="n">ssf</span><span class="p">)</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sequences/</span><span class="si">{</span><span class="n">mainseqname</span><span class="si">}</span><span class="s1">.sml&#39;</span><span class="p">,</span> <span class="n">mainseqsml</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">wfile</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wfmx_filenames</span><span class="p">,</span> <span class="n">wfmx_files</span><span class="p">):</span>
            <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Waveforms/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.wfmx&#39;</span><span class="p">,</span> <span class="n">wfile</span><span class="p">)</span>

        <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s1">&#39;setup.xml&#39;</span><span class="p">,</span> <span class="n">setup_file</span><span class="p">)</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s1">&#39;userNotes.txt&#39;</span><span class="p">,</span> <span class="n">user_file</span><span class="p">)</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">seqx</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">seqx</span></div>

<div class="viewcode-block" id="AWG70000A.makeSEQXFile"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.tektronix.html#qcodes.instrument_drivers.tektronix.AWG5208.AWG70000A.makeSEQXFile">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">makeSEQXFile</span><span class="p">(</span><span class="n">trig_waits</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">nreps</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">event_jumps</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">event_jump_to</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">go_to</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">wfms</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
                     <span class="n">amplitudes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
                     <span class="n">seqname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">flags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a full .seqx file (bundle)</span>
<span class="sd">        A .seqx file can presumably hold several sequences, but for now</span>
<span class="sd">        we support only packing a single sequence</span>

<span class="sd">        For a single sequence, a .seqx file is a bundle of two files and</span>
<span class="sd">        two folders:</span>

<span class="sd">        /Sequences</span>
<span class="sd">            sequence.sml</span>

<span class="sd">        /Waveforms</span>
<span class="sd">            wfm1.wfmx</span>
<span class="sd">            wfm2.wfmx</span>
<span class="sd">            ...</span>

<span class="sd">        setup.xml</span>
<span class="sd">        userNotes.txt</span>

<span class="sd">        Args:</span>
<span class="sd">            trig_waits: Wait for a trigger? If yes, you must specify the</span>
<span class="sd">                trigger input. 0 for off, 1 for &#39;TrigA&#39;, 2 for &#39;TrigB&#39;,</span>
<span class="sd">                3 for &#39;Internal&#39;.</span>
<span class="sd">            nreps: No. of repetitions. 0 corresponds to infinite.</span>
<span class="sd">            event_jumps: Jump when event triggered? If yes, you must specify</span>
<span class="sd">                the trigger input. 0 for off, 1 for &#39;TrigA&#39;, 2 for &#39;TrigB&#39;,</span>
<span class="sd">                3 for &#39;Internal&#39;.</span>
<span class="sd">            event_jump_to: Jump target in case of event. 1-indexed,</span>
<span class="sd">                0 means next. Must be specified for all elements.</span>
<span class="sd">            go_to: Which element to play next. 1-indexed, 0 means next.</span>
<span class="sd">            wfms: numpy arrays describing each waveform plus two markers,</span>
<span class="sd">                packed like np.array([wfm, m1, m2]). These numpy arrays</span>
<span class="sd">                are then again packed in lists according to:</span>
<span class="sd">                [[wfmch1pos1, wfmch1pos2, ...], [wfmch2pos1, ...], ...]</span>
<span class="sd">            amplitudes: The peak-to-peak amplitude in V of the channels, i.e.</span>
<span class="sd">                a list [ch1_amp, ch2_amp].</span>
<span class="sd">            seqname: The name of the sequence. This name will appear in the</span>
<span class="sd">                sequence list. Note that all spaces are converted to &#39;_&#39;</span>
<span class="sd">            flags: Flags for the auxiliary outputs. 0 for &#39;No change&#39;, 1 for</span>
<span class="sd">                &#39;High&#39;, 2 for &#39;Low&#39;, 3 for &#39;Toggle&#39;, or 4 for &#39;Pulse&#39;. 4 flags</span>
<span class="sd">                [A, B, C, D] for every channel in every element, packed like:</span>
<span class="sd">                [[ch1pos1, ch1pos2, ...], [ch2pos1, ...], ...]</span>
<span class="sd">                If omitted, no flags will be set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The binary .seqx file, ready to be sent to the instrument.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># input sanitising to avoid spaces in filenames</span>
        <span class="n">seqname</span> <span class="o">=</span> <span class="n">seqname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="p">(</span><span class="n">chans</span><span class="p">,</span> <span class="n">elms</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wfms</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">wfms</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">wfm_names</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;wfmch</span><span class="si">{</span><span class="n">ch</span><span class="si">}</span><span class="s1">pos</span><span class="si">{</span><span class="n">el</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">chans</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                     <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">elms</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

        <span class="c1"># generate wfmx files for the waveforms</span>
        <span class="n">flat_wfmxs</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># type: List[bytes]</span>
        <span class="k">for</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">wfm_lst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">,</span> <span class="n">wfms</span><span class="p">):</span>
            <span class="n">flat_wfmxs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">AWG70000A</span><span class="o">.</span><span class="n">makeWFMXFile</span><span class="p">(</span><span class="n">wfm</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">wfm</span> <span class="ow">in</span> <span class="n">wfm_lst</span><span class="p">]</span>

        <span class="c1"># This unfortunately assumes no subsequences</span>
        <span class="n">flat_wfm_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wfm_names</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                         <span class="p">(</span><span class="n">chans</span><span class="o">*</span><span class="n">elms</span><span class="p">,)))</span>

        <span class="n">sml_file</span> <span class="o">=</span> <span class="n">AWG70000A</span><span class="o">.</span><span class="n">_makeSMLFile</span><span class="p">(</span><span class="n">trig_waits</span><span class="p">,</span> <span class="n">nreps</span><span class="p">,</span>
                                          <span class="n">event_jumps</span><span class="p">,</span> <span class="n">event_jump_to</span><span class="p">,</span>
                                          <span class="n">go_to</span><span class="p">,</span> <span class="n">wfm_names</span><span class="p">,</span>
                                          <span class="n">seqname</span><span class="p">,</span>
                                          <span class="n">chans</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>

        <span class="n">user_file</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="n">setup_file</span> <span class="o">=</span> <span class="n">AWG70000A</span><span class="o">.</span><span class="n">_makeSetupFile</span><span class="p">(</span><span class="n">seqname</span><span class="p">)</span>

        <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>

        <span class="n">zipfile</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sequences/</span><span class="si">{</span><span class="n">seqname</span><span class="si">}</span><span class="s1">.sml&#39;</span><span class="p">,</span> <span class="n">sml_file</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">wfile</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flat_wfm_names</span><span class="p">,</span> <span class="n">flat_wfmxs</span><span class="p">):</span>
            <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Waveforms/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.wfmx&#39;</span><span class="p">,</span> <span class="n">wfile</span><span class="p">)</span>

        <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s1">&#39;setup.xml&#39;</span><span class="p">,</span> <span class="n">setup_file</span><span class="p">)</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s1">&#39;userNotes.txt&#39;</span><span class="p">,</span> <span class="n">user_file</span><span class="p">)</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">seqx</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">seqx</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_makeSetupFile</span><span class="p">(</span><span class="n">sequence</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a setup.xml file.</span>

<span class="sd">        Args:</span>
<span class="sd">            sequence: The name of the main sequence</span>

<span class="sd">        Returns:</span>
<span class="sd">            The setup file as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;RSAPersist&#39;</span><span class="p">)</span>
        <span class="n">head</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;Application&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Pascal&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;MainSequence&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">sequence</span>
        <span class="n">prodspec</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;ProductSpecific&#39;</span><span class="p">)</span>
        <span class="n">prodspec</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;AWG70002A&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;SerialNumber&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;B020397&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;SoftwareVersion&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;5.3.0128.0&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">prodspec</span><span class="p">,</span> <span class="s1">&#39;CreatorProperties&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">xmlstr</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span>
        <span class="n">xmlstr</span> <span class="o">=</span> <span class="n">xmlstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;</span><span class="se">\r\n</span><span class="s1">&lt;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xmlstr</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_makeSMLFile</span><span class="p">(</span><span class="n">trig_waits</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">nreps</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">event_jumps</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">event_jump_to</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">go_to</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                     <span class="n">elem_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                     <span class="n">seqname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">chans</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                     <span class="n">subseq_positions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
                     <span class="n">flags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make an xml file describing a sequence.</span>

<span class="sd">        Args:</span>
<span class="sd">            trig_waits: Wait for a trigger? If yes, you must specify the</span>
<span class="sd">                trigger input. 0 for off, 1 for &#39;TrigA&#39;, 2 for &#39;TrigB&#39;,</span>
<span class="sd">                3 for &#39;Internal&#39;.</span>
<span class="sd">            nreps: No. of repetitions. 0 corresponds to infinite.</span>
<span class="sd">            event_jumps: Jump when event triggered? If yes, you must specify</span>
<span class="sd">                the trigger input. 0 for off, 1 for &#39;TrigA&#39;, 2 for &#39;TrigB&#39;,</span>
<span class="sd">                3 for &#39;Internal&#39;.</span>
<span class="sd">            event_jump_to: Jump target in case of event. 1-indexed,</span>
<span class="sd">                0 means next. Must be specified for all elements.</span>
<span class="sd">            go_to: Which element to play next. 1-indexed, 0 means next.</span>
<span class="sd">            elem_names: The waveforms/subsequences to use. Should be packed</span>
<span class="sd">                like:</span>
<span class="sd">                [[wfmpos1ch1, wfmpos1ch2, ...],</span>
<span class="sd">                 [subseqpos2],</span>
<span class="sd">                 [wfmpos3ch1, wfmpos3ch2, ...], ...]</span>
<span class="sd">            seqname: The name of the sequence. This name will appear in</span>
<span class="sd">                the sequence list of the instrument.</span>
<span class="sd">            chans: The number of channels. Can not be inferred in the case</span>
<span class="sd">                of a sequence containing only subsequences, so must be provided</span>
<span class="sd">                up front.</span>
<span class="sd">            subseq_positions: The positions (step numbers) occupied by</span>
<span class="sd">                subsequences</span>
<span class="sd">            flags: Flags for the auxiliary outputs. 0 for &#39;No change&#39;, 1 for</span>
<span class="sd">                &#39;High&#39;, 2 for &#39;Low&#39;, 3 for &#39;Toggle&#39;, or 4 for &#39;Pulse&#39;. 4 flags</span>
<span class="sd">                [A, B, C, D] for every channel in every element, packed like:</span>
<span class="sd">                [[ch1pos1, ch1pos2, ...], [ch2pos1, ...], ...]</span>
<span class="sd">                If omitted, no flags will be set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A str containing the file contents, to be saved as an .sml file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">offsetdigits</span> <span class="o">=</span> <span class="mi">9</span>

        <span class="n">waitinputs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;TrigA&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;TrigB&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Internal&#39;</span><span class="p">}</span>
        <span class="n">eventinputs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;TrigA&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;TrigB&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Internal&#39;</span><span class="p">}</span>
        <span class="n">flaginputs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;NoChange&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Toggle&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Pulse&#39;</span><span class="p">}</span>

        <span class="n">inputlsts</span> <span class="o">=</span> <span class="p">[</span><span class="n">trig_waits</span><span class="p">,</span> <span class="n">nreps</span><span class="p">,</span> <span class="n">event_jump_to</span><span class="p">,</span> <span class="n">go_to</span><span class="p">]</span>
        <span class="n">lstlens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">inputlsts</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lstlens</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">lstlens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lstlens</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;All input lists must have the same length!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lstlens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Received empty sequence option lengths!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lstlens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem_names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Mismatch between number of waveforms and&#39;</span>
                             <span class="s1">&#39; number of sequencing steps.&#39;</span><span class="p">)</span>

        <span class="n">N</span> <span class="o">=</span> <span class="n">lstlens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># form the timestamp string</span>
        <span class="n">timezone</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span>
        <span class="n">tz_m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">timezone</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">tz_h</span><span class="p">,</span> <span class="n">tz_m</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">tz_m</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">tz_h</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">signstr</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
            <span class="n">tz_h</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signstr</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
        <span class="n">timestr</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">timestr</span> <span class="o">+=</span> <span class="n">signstr</span>
        <span class="n">timestr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tz_h</span><span class="si">:</span><span class="s1">02.0f</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">tz_m</span><span class="si">:</span><span class="s1">02.0f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">datafile</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;DataFile&#39;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="o">*</span><span class="n">offsetdigits</span><span class="p">,</span>
                                                  <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;0.1&#39;</span><span class="p">})</span>
        <span class="n">dsc</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="s1">&#39;DataSetsCollection&#39;</span><span class="p">)</span>
        <span class="n">dsc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;xmlns&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.tektronix.com&quot;</span><span class="p">)</span>
        <span class="n">dsc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;xmlns:xsi&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="p">)</span>
        <span class="n">dsc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;xsi:schemaLocation&quot;</span><span class="p">,</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;http://www.tektronix.com file:///&quot;</span> <span class="o">+</span>
                                       <span class="sa">r</span><span class="s2">&quot;C:\Program</span><span class="si">%20F</span><span class="s2">iles\Tektronix\AWG70000&quot;</span> <span class="o">+</span>
                                       <span class="sa">r</span><span class="s2">&quot;\AWG\Schemas\awgSeqDataSets.xsd&quot;</span><span class="p">))</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">dsc</span><span class="p">,</span> <span class="s1">&#39;DataSets&#39;</span><span class="p">)</span>
        <span class="n">datasets</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="n">datasets</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;xmlns&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.tektronix.com&quot;</span><span class="p">)</span>

        <span class="c1"># Description of the data</span>
        <span class="n">datadesc</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s1">&#39;DataDescription&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;SequenceName&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">seqname</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;Timestamp&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">timestr</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;JumpTiming&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;JumpImmed&#39;</span>  <span class="c1"># TODO: What does this control?</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;RecSampleRate&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;NaN&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;RepeatFlag&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;PatternJumpTable&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;Enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="s1">&#39;65536&#39;</span><span class="p">)</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="s1">&#39;Steps&#39;</span><span class="p">)</span>
        <span class="n">steps</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;StepCount&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">N</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">steps</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;TrackCount&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">chans</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="s1">&#39;Step&#39;</span><span class="p">)</span>
            <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;StepNumber&#39;</span><span class="p">)</span>
            <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="c1"># repetitions</span>
            <span class="n">rep</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;Repeat&#39;</span><span class="p">)</span>
            <span class="n">repcount</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;RepeatCount&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nreps</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rep</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Infinite&#39;</span>
                <span class="n">repcount</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="k">elif</span> <span class="n">nreps</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rep</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Once&#39;</span>
                <span class="n">repcount</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rep</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;RepeatCount&quot;</span>
                <span class="n">repcount</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nreps</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># trigger wait</span>
            <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;WaitInput&#39;</span><span class="p">)</span>
            <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">waitinputs</span><span class="p">[</span><span class="n">trig_waits</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="c1"># event jump</span>
            <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;EventJumpInput&#39;</span><span class="p">)</span>
            <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">eventinputs</span><span class="p">[</span><span class="n">event_jumps</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">jumpto</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;EventJumpTo&#39;</span><span class="p">)</span>
            <span class="n">jumpstep</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;EventJumpToStep&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">event_jump_to</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">jumpto</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Next&#39;</span>
                <span class="n">jumpstep</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">jumpto</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;StepIndex&quot;</span>
                <span class="n">jumpstep</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event_jump_to</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># Go to</span>
            <span class="n">goto</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;GoTo&#39;</span><span class="p">)</span>
            <span class="n">gotostep</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;GoToStep&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">go_to</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">goto</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Next&#39;</span>
                <span class="n">gotostep</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">goto</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;StepIndex&quot;</span>
                <span class="n">gotostep</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">go_to</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">assets</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">assetname</span> <span class="ow">in</span> <span class="n">elem_names</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">asset</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="s1">&#39;Asset&#39;</span><span class="p">)</span>
                <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="s1">&#39;AssetName&#39;</span><span class="p">)</span>
                <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">assetname</span>
                <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="s1">&#39;AssetType&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">subseq_positions</span><span class="p">:</span>
                    <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Sequence&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Waveform&#39;</span>

            <span class="c1"># convert flag settings to strings</span>
            <span class="n">flags_list</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;Flags&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chans</span><span class="p">):</span>
                <span class="n">flagset</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">flags_list</span><span class="p">,</span> <span class="s1">&#39;FlagSet&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">flgind</span><span class="p">,</span> <span class="n">flg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]):</span>
                    <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">flagset</span><span class="p">,</span> <span class="s1">&#39;Flag&#39;</span><span class="p">)</span>
                    <span class="n">temp_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">flg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">flags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># no flags were passed to the function</span>
                        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;NoChange&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">flaginputs</span><span class="p">[</span><span class="n">flags</span><span class="p">[</span><span class="n">chan</span><span class="p">][</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">flgind</span><span class="p">]]</span>

        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s1">&#39;ProductSpecific&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">temp_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="s1">&#39;Setup&#39;</span><span class="p">)</span>

        <span class="c1"># the tostring() call takes roughly 75% of the total</span>
        <span class="c1"># time spent in this function. Can we speed up things?</span>
        <span class="c1"># perhaps we should use lxml?</span>
        <span class="n">xmlstr</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span>
        <span class="n">xmlstr</span> <span class="o">=</span> <span class="n">xmlstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;</span><span class="se">\r\n</span><span class="s1">&lt;&#39;</span><span class="p">)</span>

        <span class="c1"># As the final step, count the length of the header and write this</span>
        <span class="c1"># in the DataFile tag attribute &#39;offset&#39;</span>

        <span class="n">xmlstr</span> <span class="o">=</span> <span class="n">xmlstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="o">*</span><span class="n">offsetdigits</span><span class="p">,</span>
                                <span class="s1">&#39;{num:0</span><span class="si">{pad}</span><span class="s1">d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xmlstr</span><span class="p">),</span>
                                                       <span class="n">pad</span><span class="o">=</span><span class="n">offsetdigits</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">xmlstr</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>